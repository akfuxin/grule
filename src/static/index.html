<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Rule Engine</title>
    <link rel="stylesheet" href="../css/lib/heyui.css" />
    <script src="../js/lib/vue.js"></script>
    <script src="../js/lib/heyui.js"></script>
    <script src="../js/lib/httpVueLoader.js"></script>
    <script src="../js/components.js"></script>
    <script src="../js/lib/jquery-3.4.1.js"></script>
</head>
<body>
<div id="app">
    <Admin v-show="user"></Admin>
    <Login v-show="!user"></Login>
</div>
</body>
<script>
    let app = new Vue({
        el: '#app',
        data: {
            // 当前登录用户信息
            user: null
        },
        mounted: function () {
            this.getCurrentUser()
        },
        methods: {
            getCurrentUser: function () {
                let _this = this;
                $.ajax({
                    url: 'mnt/getCurrentUser',
                    success: function (res) {
                        if (res.code == '00') {
                            _this.user = res.data
                        } else _this.$Notice({type: 'error', content: res.desc, timeout: 5})
                    }
                })
            }
        }
    });

    $.ajaxSetup({
        complete: function(xhr,status) {
            if (status == 401) { // 登录实效 or 未登录
                app.$data.user = null
            }
        }
    });

</script>
</html>